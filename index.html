<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEMSIRA Discipline System</title>
    
    <link rel="icon" type="image/png" href="semsira.png">

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background-color: #f0f2f5; }
        
        /* Navigation / Header */
        .navbar {
            background-color: white;
            padding: 10px 30px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .navbar img {
            height: 50px; /* Adjust size of logo */
            margin-right: 15px;
        }
        .navbar h1 {
            font-size: 20px;
            color: #1a73e8;
            margin: 0;
        }

        .container { max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        
        /* Form Styling */
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 6px; flex: 1; min-width: 200px; }
        button { padding: 10px 20px; background-color: #1a73e8; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:hover { background-color: #1557b0; }

        /* Search Bar */
        #searchBox { width: 100%; margin-bottom: 20px; padding: 12px; border: 2px solid #e8f0fe; border-radius: 6px; box-sizing: border-box; font-size: 16px; }

        /* Table */
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; border-bottom: 1px solid #eee; text-align: left; }
        th { background-color: #f8f9fa; color: #5f6368; font-size: 13px; }
        
        /* Auto-Counter Highlight */
        .warning-row { background-color: #fff5f5 !important; color: #d93025; font-weight: bold; }
        .badge { padding: 4px 8px; border-radius: 4px; background: #e8f0fe; color: #1967d2; }
        .warning-row .badge { background: #d93025; color: white; }

        .delete-btn { background-color: #ea4335; font-size: 12px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="navbar">
    <img src="semsira.png" alt="SEMSIRA Logo">
    <h1>SEMSIRA Student Discipline Dashboard</h1>
</div>

<div class="container">
    <div class="input-group">
        <input type="text" id="stuName" placeholder="Student Full Name">
        <input type="text" id="stuClass" placeholder="Class (e.g., 3S1)">
        <input type="text" id="violation" placeholder="Offence Description">
        <button onclick="submitRecord()">Key-in Record</button>
    </div>

    <input type="text" id="searchBox" onkeyup="filterRecords()" placeholder="ðŸ” Search records by name or class...">

    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Class</th>
                <th>Last Offence</th>
                <th>Total Counts</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="recordBody">
            </tbody>
    </table>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, updateDoc, query, where, getDocs, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Your Firebase Configuration (Keep this private)
    const firebaseConfig = {
        apiKey: "AIzaSyCqY9ADs8oy1Uvh3-7eVCQLYfyTijm8lo4",
        authDomain: "bdpsemsira-5c274.firebaseapp.com",
        projectId: "bdpsemsira-5c274",
        storageBucket: "bdpsemsira-5c274.firebasestorage.app",
        messagingSenderId: "176946808975",
        appId: "1:176946808975:web:ef7447a11bb57fe71b88fa",
        measurementId: "G-NS4NJPK1EB"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const colRef = collection(db, "students");

    // --- SUBMIT RECORD ---
    window.submitRecord = async () => {
        const name = document.getElementById('stuName').value.trim();
        const className = document.getElementById('stuClass').value.trim();
        const offence = document.getElementById('violation').value.trim();

        if (!name || !className) return alert("Please fill in both Name and Class");

        const q = query(colRef, where("name", "==", name));
        const querySnapshot = await getDocs(q);

        if (!querySnapshot.empty) {
            const studentDoc = querySnapshot.docs[0];
            await updateDoc(doc(db, "students", studentDoc.id), {
                offence: offence,
                counts: increment(1)
            });
        } else {
            await addDoc(colRef, {
                name: name,
                class: className,
                offence: offence,
                counts: 1
            });
        }
        document.getElementById('stuName').value = "";
        document.getElementById('violation').value = "";
    };

    // --- LIVE DISPLAY ---
    onSnapshot(colRef, (snapshot) => {
        let rows = "";
        snapshot.docs.forEach(docData => {
            const data = docData.data();
            const id = docData.id;
            const rowStyle = data.counts >= 3 ? "warning-row" : "";
            
            rows += `
                <tr class="${rowStyle}">
                    <td>${data.name}</td>
                    <td>${data.class}</td>
                    <td>${data.offence}</td>
                    <td><span class="badge">${data.counts}</span></td>
                    <td><button class="delete-btn" onclick="deleteRecord('${id}')">Delete</button></td>
                </tr>
            `;
        });
        document.getElementById('recordBody').innerHTML = rows;
    });

    // --- DELETE ---
    window.deleteRecord = async (id) => {
        if(confirm("Delete this student's data permanently?")) {
            await deleteDoc(doc(db, "students", id));
        }
    };

    // --- SEARCH ---
    window.filterRecords = () => {
        const term = document.getElementById('searchBox').value.toLowerCase();
        const rows = document.querySelectorAll('#recordBody tr');
        rows.forEach(row => {
            row.style.display = row.innerText.toLowerCase().includes(term) ? "" : "none";
        });
    };
</script>

</body>
</html>
